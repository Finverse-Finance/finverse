# Next Feature: Daily Reports Page (`@daily-reports`)

## ðŸ§¾ Overview

- This page will **generate a customized Daily Financial Summary** (and extended reports) by analyzing user transactions and account balances from Plaid.
- Users can **select time ranges** (daily, weekly, monthly, all time) and **view category-specific reports**.
- The report is generated by passing a JSON object (from the user's MongoDB) into Gemini 2.0 flash LLM using the Vercel AI SDK.
- All output reports must be error free and provide complete, necessary information for data analysis.
- The env keys for google and gemini are setup to use out of the box, so refer to the Vercel AI SDK docs to help implement in a api route.
---

## 1. ðŸ“ˆ Data Aggregation

- **Data Source:** Retrieve user transactions and account balances from MongoDB.
  - **Transactions:** JSON array (fields: `date`, `amount`, `category`, `notes`, `isManual`)
  - **Accounts:** JSON array (fields: `name`, `type`, `current balance`)
- **API Endpoint:**
  - Create an API route (e.g., `/api/daily-reports`) to fetch data.
  - Apply query filters for the selected time range and category preferences before returning the data.
  - Support extended time ranges: **daily, weekly, monthly, and all time.**

---

## 2. ðŸ¤– Gemini 2.0 Flash LLM Integration with Customization

- **LLM Prompt:** The Gemini 2.0 prompt will be dynamically generated using variables from the frontend Zod form. For example:
  ```ts
  const geminiPrompt = `
  You are a personal finance assistant generating a detailed, error-free, and customized Financial Summary for a user.

  Your goal is to provide an insightful summary that analyzes the userâ€™s spending, income, and overall financial behavior based on the selected time range: ${timeRange}.
  Include the following elements:

  1. **Overall Overview:**
     - Total spent vs. total income
     - Net difference (savings or overspending)
     - Notable spending patterns and any outlier transactions
     - A brief analysis that varies depending on whether the report covers a day, week, month, or all time.

  2. **Time Range Analysis:**
     - For ${timeRange} reports, include trends or comparisons with previous periods when relevant.
  
  3. **Category Reports:**
     - Break down spending by category and highlight the top 1-2 spending categories.
     - Offer insights if there is an unusual pattern or if the user consistently overspends in certain categories.
  
  4. **Custom Insights:**
     - Analyze the data with error free logic to provide all necessary info for understanding financial behavior.
     - Tailor the analysis based on any additional filters or customizations provided by the user.

  Use the following input format:

  - \`transactions\`: JSON array (fields: date, amount, category, notes, isManual)
  - \`accounts\`: JSON array (fields: name, type, current balance)

  Now, based on the provided input and customization settings, generate the Financial Summary:
  `;
  ```
- **Processing Flow:**
  - On clicking "Generate Report," collect user input via a Zod form (time range and category filters).
  - Fetch the filtered JSON data from MongoDB.
  - Merge the data with user customization settings, then pass these as variables in the prompt to Gemini 2.0 through the Vercel AI SDK.
  - Render the generated report on the page.

---

## 3. ðŸŽ¨ UI & Component Library

- **Framework:** Use **shadcn/ui** for building all UI components.
- **Customization Panel:**
  - **Zod Form for Customization:**  
    Create a form with the following fields:
    - **Time Range Filter:** Dropdown with options: Daily, Weekly, Monthly, All Time.
    - **Category Filters:** Multi-select dropdown for categories.
  - **UI Layout:**  
    The customization form should appear at the top of the page or in a sidebar.
  - **Action:**  
    Include a â€œGenerate Reportâ€ button that triggers:
      - Form validation using Zod.
      - API call for data retrieval.
      - Generation of the Gemini 2.0 prompt with user-selected variables.
- **Interactive Charts & Data Visuals (Optional):**
  - Integrate charts (e.g., using Chart.js or Recharts) to graphically display trend and category analysis.
  - Allow users to interact with visualizations for deeper insights.

- **Vercel AI SDK Integration:**
  - Follow the [Vercel AI SDK documentation](https://sdk.vercel.ai/providers/ai-sdk-providers/google-generative-ai) for sending the prompt and retrieving the AI-generated summary.
  - Ensure error handling and smooth user interaction during the generation process.

---

## 4. âš™ï¸ Integration & Processing Logic

1. **Data Fetching and Filtering:**
   - Build the `/api/daily-reports` endpoint to filter transactions based on the selected time range and any category filters.
   - Return a JSON object containing:
     - `transactions`: Filtered transactions array.
     - `accounts`: Up-to-date account balances.

2. **Zod Form Integration:**
   - Implement a Zod schema on the frontend for validating user input.
   - Ensure the form collects:
     - Time Range: Must be one of "Daily", "Weekly", "Monthly", or "All Time".
     - Categories: Array of strings for filtering transactions.

3. **Gemini 2.0 Prompt Execution:**
   - After form validation, generate the prompt dynamically with inserted variables (`timeRange`, selected categories, etc.).
   - Invoke the Gemini 2.0 flash LLM via the Vercel AI SDK and pass the merged JSON data and customized prompt.

4. **Render Report & Interactive Analysis:**
   - Render the generated Financial Summary in a user-friendly, styled component.
   - Display interactive charts and visual elements for further analysis of spending trends and category breakdowns.

5. **Testing and Error Handling:**
   - Confirm the report displays all required information correctly.
   - Verify that customization options work error free and that the output report is comprehensive for data analysis.

---

## âœ… Summary of Steps

1. **API Setup and Data Retrieval:**
   - Create the `/api/daily-reports` endpoint.
   - Implement filtering for time range and category based on user input.

2. **Zod Form for Customizations:**
   - Build a form using Zod for validation.
   - Include time range and category filters.
   - Trigger report generation on form submission.

3. **Integrate Gemini 2.0 Flash LLM:**
   - Dynamically generate the prompt with user variables.
   - Use the Vercel AI SDK to obtain a detailed, error-free Financial Summary.

4. **UI Development with shadcn/ui:**
   - Build out the customization panel, report display area, and interactive charts.
   - Ensure the user can analyze and interact with the data easily.

5. **Testing and Iteration:**
   - Ensure the final report is comprehensive, error free, and meets the rubric's requirements.
   - Validate different scenarios (extended time ranges, category-specific analysis).

---

## ðŸ“ Important Notes

- **User Customization:** Empower users to choose time ranges and categories, creating a detailed analysis tailored to their preferences.
- **Error Free Reports:** The prompt and downstream processing should produce data that is clear, complete, and actionable.
- **UI Consistency:** Utilize shadcn/ui for consistent styling and improved user experience.
- **Vercel AI SDK:** Refer to the [Vercel AI SDK docs](https://sdk.vercel.ai/providers/ai-sdk-providers/google-generative-ai) for robust AI integration.
- **Data Integrity:** Ensure that all data is correctly filtered and formatted before being sent to Gemini 2.0.

---

## ðŸ”¨ Let's Start

- **Step 1:** Make the API endpoint `/api/daily-reports` to accept time range and category filtering parameters, and use vercel ai sdk.
- **Step 2:** Implement a Zod form on the frontend to collect customization settings.
- **Step 3:** Update the Gemini 2.0 prompt to include dynamic variables for time range and category reports.
- **Step 4:** Build the UI using shadcn/ui components and integrate interactive charts for enhanced data analysis.
- **Step 5:** Test the complete flow: data fetching, form validation, prompt execution, and report rendering.

> Begin with the API and Zod form setup to ensure that customization inputs are validated correctly, then progress to AI prompt integration and UI development. This will produce robust, error free, and highly informative output reports tailored to each user's analysis needs.
